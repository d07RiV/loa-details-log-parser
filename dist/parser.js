var e=require("lodash");function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},t.apply(this,arguments)}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)}function n(e,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},n(e,t)}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}var s,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};s=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var l=Number.isNaN||function(e){return e!=e};function m(){m.init.call(this)}var u=m;m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var c=10;function d(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?m.defaultMaxListeners:e._maxListeners}function g(e,t,i,n){var a,s,r;if(d(i),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),r=s[t]),void 0===r)r=s[t]=i,++e._eventsCount;else if("function"==typeof r?r=s[t]=n?[i,r]:[r,i]:n?r.unshift(i):r.push(i),(a=h(e))>0&&r.length>a&&!r.warned){r.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=r.length,console&&console.warn&&console.warn(o)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},a=f.bind(n);return a.listener=i,n.wrapFn=a,a}function v(e,t,i){var n=e._events;if(void 0===n)return[];var a=n[t];return void 0===a?[]:"function"==typeof a?i?[a.listener||a]:[a]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(a):y(a,a.length)}function k(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function y(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function T(e,t,i,n){if("function"==typeof e.on)n.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function a(s){n.once&&e.removeEventListener(t,a),i(s)})}}function _(e,t,i,n){if(void 0===t&&(t=0),void 0===i&&(i=10),void 0===n&&(n=!1),"number"==typeof e)return isNaN(e)?t:e;var a;try{a=n?parseFloat(e):parseInt(e,i),isNaN(a)&&(a=t)}catch(e){a=t}return a}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||l(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),m.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||l(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},m.prototype.getMaxListeners=function(){return h(this)},m.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,a=this._events;if(void 0!==a)n=n&&void 0===a.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var r=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw r.context=s,r}var l=a[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var m=l.length,u=y(l,m);for(i=0;i<m;++i)o(u[i],this,t)}return!0},m.prototype.on=m.prototype.addListener=function(e,t){return g(this,e,t,!1)},m.prototype.prependListener=function(e,t){return g(this,e,t,!0)},m.prototype.once=function(e,t){return d(t),this.on(e,p(this,e,t)),this},m.prototype.prependOnceListener=function(e,t){return d(t),this.prependListener(e,p(this,e,t)),this},m.prototype.off=m.prototype.removeListener=function(e,t){var i,n,a,s,r;if(d(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(a=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){r=i[s].listener,a=s;break}if(a<0)return this;0===a?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,a),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,r||t)}return this},m.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var a,s=Object.keys(i);for(n=0;n<s.length;++n)"removeListener"!==(a=s[n])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},m.prototype.listeners=function(e){return v(this,e,!0)},m.prototype.rawListeners=function(e){return v(this,e,!1)},m.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):k.call(e,t)},m.prototype.listenerCount=k,m.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]},u.once=function(e,t){return new Promise(function(i,n){function a(i){e.removeListener(t,s),n(i)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",a),i([].slice.call(arguments))}T(e,t,s,{once:!0}),"error"!==t&&function(e,t,i){"function"==typeof e.on&&T(e,"error",t,{once:!0})}(e,a)})};var I,b,L=function(e){this.lineSplit=void 0,this.timestamp=void 0,this.lineSplit=e,this.timestamp=new Date(this.lineSplit[1])},A=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).message=void 0,i.message=i.lineSplit[2],i}return i(t,e),t}(L),N=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).phaseCode=void 0,i.phaseCode=_(t[2]),i}return i(t,e),t}(L),H=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).id=void 0,i.name=void 0,i.classId=void 0,i.class=void 0,i.gearScore=void 0,i.currentHp=void 0,i.maxHp=void 0,i.id=t[2],i.name=t[3]||"Unknown Entity",i.classId=_(t[4]),i.class=t[5]||"UnknownClass",i.gearScore=_(t[7],0,10,!0),i.currentHp=_(t[8]),i.maxHp=_(t[9]),i}return i(t,e),t}(L),E=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).id=void 0,i.npcId=void 0,i.name=void 0,i.currentHp=void 0,i.maxHp=void 0,i.id=t[2],i.npcId=_(t[3]),i.name=t[4]||"Unknown Entity",i.currentHp=_(t[5]),i.maxHp=_(t[6]),i}return i(t,e),t}(L),O=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).id=void 0,i.name=void 0,i.killerId=void 0,i.killerName=void 0,i.id=t[2],i.name=t[3]||"Unknown Entity",i.killerId=t[4],i.killerName=t[5]||"Unknown Entity",i}return i(t,e),t}(L),D=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).id=void 0,i.name=void 0,i.skillId=void 0,i.skillName=void 0,i.id=t[2],i.name=t[3]||"Unknown Entity",i.skillId=_(t[4]),i.skillName=t[5]||"Unknown Skill",i}return i(t,e),t}(L),S=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).id=void 0,i.name=void 0,i.skillId=void 0,i.skillName=void 0,i.skillStage=void 0,i.id=t[2],i.name=t[3]||"Unknown Entity",i.skillId=t[4],i.skillName=t[5]||"Unknown Skill",i.skillStage=_(t[6]),i}return i(t,e),t}(L),w=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).id=void 0,i.name=void 0,i.skillId=void 0,i.skillName=void 0,i.skillEffectId=void 0,i.skillEffect=void 0,i.targetId=void 0,i.targetName=void 0,i.damage=void 0,i.damageModifier=void 0,i.currentHp=void 0,i.maxHp=void 0,i.id=t[2],i.name=t[3]||"Unknown Entity",i.skillId=_(t[4]),i.skillName=t[5]||"Unknown Skill",i.skillEffectId=_(t[6]),i.skillEffect=t[7],i.targetId=t[8],i.targetName=t[9]||"Unknown Entity",i.damage=_(t[10]),i.damageModifier=_(t[11],0,16),i.currentHp=_(t[12]),i.maxHp=_(t[13]),i}return i(t,e),t}(L),C=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).id=void 0,i.name=void 0,i.healAmount=void 0,i.id=t[2],i.name=t[3]||"Unknown Entity",i.healAmount=_(t[4]),i}return i(t,e),t}(L),R=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).id=void 0,i.name=void 0,i.buffId=void 0,i.buffName=void 0,i.isNew=void 0,i.sourceId=void 0,i.sourceName=void 0,i.shieldAmount=void 0,i.id=t[2],i.name=t[3]||"Unknown Entity",i.buffId=t[4],i.buffName=t[5],i.isNew="1"==t[6],i.sourceId=t[7],i.sourceName=t[8]||"Unknown Entity",i.shieldAmount=_(t[9]),i}return i(t,e),t}(L),P=/*#__PURE__*/function(e){function t(t){var i;return(i=e.call(this,t)||this).id=void 0,i.name=void 0,i.id=t[2],i.name=t[3]||"Unknown Entity",i}return i(t,e),t}(L),F={"Serenade of Salvation":{duration:3},"Holy Aura":{duration:16e3},"Holy Protection":{duration:7e3},Demonize:{duration:1500}};!function(e){e[e.HIT_OPTION_NONE=-1]="HIT_OPTION_NONE",e[e.HIT_OPTION_BACK_ATTACK=0]="HIT_OPTION_BACK_ATTACK",e[e.HIT_OPTION_FRONTAL_ATTACK=1]="HIT_OPTION_FRONTAL_ATTACK",e[e.HIT_OPTION_FLANK_ATTACK=2]="HIT_OPTION_FLANK_ATTACK",e[e.HIT_OPTION_MAX=3]="HIT_OPTION_MAX"}(I||(I={})),function(e){e[e.HIT_FLAG_NORMAL=0]="HIT_FLAG_NORMAL",e[e.HIT_FLAG_CRITICAL=1]="HIT_FLAG_CRITICAL",e[e.HIT_FLAG_MISS=2]="HIT_FLAG_MISS",e[e.HIT_FLAG_INVINCIBLE=3]="HIT_FLAG_INVINCIBLE",e[e.HIT_FLAG_DOT=4]="HIT_FLAG_DOT",e[e.HIT_FLAG_IMMUNE=5]="HIT_FLAG_IMMUNE",e[e.HIT_FLAG_IMMUNE_SILENCED=6]="HIT_FLAG_IMMUNE_SILENCED",e[e.HIT_FLAG_FONT_SILENCED=7]="HIT_FLAG_FONT_SILENCED",e[e.HIT_FLAG_DOT_CRITICAL=8]="HIT_FLAG_DOT_CRITICAL",e[e.HIT_FLAG_DODGE=9]="HIT_FLAG_DODGE",e[e.HIT_FLAG_REFLECT=10]="HIT_FLAG_REFLECT",e[e.HIT_FLAG_DAMAGE_SHARE=11]="HIT_FLAG_DAMAGE_SHARE",e[e.HIT_FLAG_DODGE_HIT=12]="HIT_FLAG_DODGE_HIT",e[e.HIT_FLAG_MAX=13]="HIT_FLAG_MAX"}(b||(b={})),exports.LogParser=/*#__PURE__*/function(n){function s(e){var t;return void 0===e&&(e=!1),(t=n.call(this)||this).resetTimer=void 0,t.debugLines=void 0,t.isLive=void 0,t.dontResetOnZoneChange=void 0,t.resetAfterPhaseTransition=void 0,t.splitOnPhaseTransition=void 0,t.removeOverkillDamage=void 0,t.phaseTransitionResetRequest=void 0,t.phaseTransitionResetRequestTime=void 0,t.game=void 0,t.encounters=void 0,t.healSources=void 0,t.resetTimer=null,t.debugLines=!1,t.isLive=e,t.dontResetOnZoneChange=!1,t.resetAfterPhaseTransition=!1,t.splitOnPhaseTransition=!1,t.removeOverkillDamage=!0,t.phaseTransitionResetRequest=!1,t.phaseTransitionResetRequestTime=0,t.resetState(),t.encounters=[],t.isLive&&setInterval(t.broadcastStateChange.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)),100),t}i(s,n);var r=s.prototype;return r.resetState=function(){this.debugLines&&this.emit("log",{type:"debug",message:"Resetting state"});var t=e.cloneDeep(this.game),i=+new Date;this.game={startedOn:i,lastCombatPacket:i,fightStartedOn:0,entities:{},damageStatistics:{totalDamageDealt:0,topDamageDealt:0,totalDamageTaken:0,topDamageTaken:0,totalHealingDone:0,topHealingDone:0,totalShieldDone:0,topShieldDone:0}},this.healSources=[],this.emit("reset-state",t)},r.softReset=function(){this.resetTimer=null;var t=e.cloneDeep(this.game.entities);this.resetState();for(var i=0,n=Object.keys(t);i<n.length;i++){var a=n[i];+new Date-t[a].lastUpdate>6e5||this.updateEntity(t[a].name,{name:t[a].name,npcId:t[a].npcId,class:t[a].class,classId:t[a].classId,isPlayer:t[a].isPlayer,gearScore:t[a].gearScore,maxHp:t[a].maxHp,currentHp:t[a].currentHp})}},r.cancelReset=function(){this.resetTimer&&clearTimeout(this.resetTimer),this.resetTimer=null},r.splitEncounter=function(){var t=e.cloneDeep(this.game);0==t.fightStartedOn||0==t.damageStatistics.totalDamageDealt&&!t.damageStatistics.totalDamageTaken||this.encounters.push(t),this.resetState()},r.broadcastStateChange=function(){var t=e.cloneDeep(this.game);Object.values(t.entities).forEach(function(e){Object.values(e.skills).forEach(function(e){e.breakdown=[]})}),this.emit("state-change",t)},r.parseLogLine=function(e){if(e){var t=e.trim().split("|");if(!(t.length<1)&&t[0]){var i=_(t[0]);try{switch(i){case 0:this.onMessage(t);break;case 1:this.onInitEnv();break;case 2:this.onPhaseTransition(t);break;case 3:this.onNewPc(t);break;case 4:this.onNewNpc(t);break;case 5:this.onDeath(t);break;case 6:this.onSkillStart(t);break;case 7:this.onSkillStage(t);break;case 8:this.onDamage(t);break;case 9:this.onHeal(t);break;case 10:this.onBuff(t);break;case 12:this.onCounterattack(t)}}catch(e){this.emit("log",{type:"error",message:e})}}}},r.updateEntity=function(e,i){var n={},a=this.game.entities[e];!i.currentHp||a&&i.currentHp===a.currentHp||(n.lastUpdate=+new Date),this.game.entities[e]=t({},a||{lastUpdate:0,id:"",npcId:0,name:"",class:"",classId:0,isPlayer:!1,isDead:!1,deaths:0,deathTime:0,gearScore:0,currentHp:0,maxHp:0,damageDealt:0,healingDone:0,shieldDone:0,damageTaken:0,skills:{},hits:{casts:0,total:0,crit:0,backAttack:0,frontAttack:0,counter:0}},i,n)},r.onMessage=function(e){var t=new A(e);this.debugLines&&this.emit("log",{type:"debug",message:"onMessage: "+t.message}),t.message.startsWith("Arguments:")||this.emit("message",t.message)},r.onInitEnv=function(){this.debugLines&&this.emit("log",{type:"debug",message:"onInitEnv"}),this.isLive?!1===this.dontResetOnZoneChange&&null==this.resetTimer&&(this.debugLines&&this.emit("log",{type:"debug",message:"Setting a reset timer"}),this.resetTimer=setTimeout(this.softReset.bind(this),6e3),this.emit("message","new-zone")):(this.splitEncounter(),this.emit("message","new-zone"))},r.onPhaseTransition=function(e){var t=new N(e);this.debugLines&&this.emit("log",{type:"debug",message:"onPhaseTransition: "+t.phaseCode}),this.isLive&&(this.emit("message","phase-transition-"+t.phaseCode),this.resetAfterPhaseTransition&&(this.phaseTransitionResetRequest=!0,this.phaseTransitionResetRequestTime=+new Date)),!this.isLive&&this.splitOnPhaseTransition&&this.splitEncounter()},r.onNewPc=function(e){var i=new H(e);this.debugLines&&this.emit("log",{type:"debug",message:"onNewPc: "+i.id+", "+i.name+", "+i.classId+", "+i.class+", "+i.gearScore+", "+i.currentHp+", "+i.maxHp}),this.updateEntity(i.name,t({id:i.id,name:i.name,class:i.class,classId:i.classId,isPlayer:!0},i.gearScore&&0!=i.gearScore&&{gearScore:i.gearScore},{currentHp:i.currentHp,maxHp:i.maxHp}))},r.onNewNpc=function(e){var t=new E(e);this.debugLines&&this.emit("log",{type:"debug",message:"onNewNpc: "+t.id+", "+t.name+", "+t.currentHp+", "+t.maxHp}),this.updateEntity(t.name,{id:t.id,name:t.name,npcId:t.npcId,isPlayer:!1,currentHp:t.currentHp,maxHp:t.maxHp})},r.onDeath=function(e){var t=new O(e);this.debugLines&&this.emit("log",{type:"debug",message:"onDeath: "+t.name+" "+t.killerName});var i=this.game.entities[t.name];this.updateEntity(t.name,{name:t.name,isDead:!0,deathTime:+t.timestamp,deaths:i?i.isDead?i.deaths:i.deaths+1:1})},r.onSkillStart=function(e){var i=new D(e);this.debugLines&&this.emit("log",{type:"debug",message:"onSkillStart: "+i.id+", "+i.name+", "+i.skillId+", "+i.skillName}),Object.keys(F).includes(i.skillName)&&this.healSources.push({source:i.name,expires:+i.timestamp+F[i.skillName].duration}),this.updateEntity(i.name,{name:i.name,isDead:!1});var n=this.game.entities[i.name];n&&(n.hits.casts+=1,i.skillName in n.skills||(n.skills[i.skillName]=t({},{id:0,name:"",totalDamage:0,maxDamage:0,hits:{casts:0,total:0,crit:0,backAttack:0,frontAttack:0,counter:0},breakdown:[]},{id:i.skillId,name:i.skillName}),n.skills[i.skillName].hits.casts+=1))},r.onSkillStage=function(e){var t=new S(e);this.debugLines&&this.emit("log",{type:"debug",message:"onSkillStage: "+t.name+", "+t.skillId+", "+t.skillName+", "+t.skillStage})},r.onDamage=function(e){if(!(e.length<13)){var i=new w(e);this.debugLines&&this.emit("log",{type:"debug",message:"onDamage: "+i.id+", "+i.name+", "+i.skillId+", "+i.skillName+", "+i.skillEffectId+", "+i.skillEffect+", "+i.targetId+", "+i.targetName+", "+i.damage+", "+i.currentHp+", "+i.maxHp}),this.phaseTransitionResetRequest&&this.phaseTransitionResetRequestTime>0&&this.phaseTransitionResetRequestTime<+new Date-1500&&(this.softReset(),this.phaseTransitionResetRequest=!1),this.updateEntity(i.name,{id:i.id,name:i.name}),this.updateEntity(i.targetName,{id:i.targetId,name:i.targetName,currentHp:i.currentHp,maxHp:i.maxHp});var n=this.game.entities[i.name],a=this.game.entities[i.targetName];!a.isPlayer&&this.removeOverkillDamage&&i.currentHp<0&&(i.damage=i.damage+i.currentHp),0===i.skillId&&0!==i.skillEffectId&&(i.skillId=i.skillEffectId,i.skillName=i.skillEffect),i.skillName in n.skills||(n.skills[i.skillName]=t({},{id:0,name:"",totalDamage:0,maxDamage:0,hits:{casts:0,total:0,crit:0,backAttack:0,frontAttack:0,counter:0},breakdown:[]},{id:i.skillId,name:i.skillName}));var s=15&i.damageModifier,r=(i.damageModifier>>4&7)-1;if(!("Bleed"===i.skillName&&i.damage>1e7||"Bleed"===i.skillName&&s===b.HIT_FLAG_DAMAGE_SHARE)){var o=s===b.HIT_FLAG_CRITICAL||s===b.HIT_FLAG_DOT_CRITICAL,l=r===I.HIT_OPTION_BACK_ATTACK,m=r===I.HIT_OPTION_FRONTAL_ATTACK,u=o?1:0,c=l?1:0,d=m?1:0;n.skills[i.skillName].totalDamage+=i.damage,i.damage>n.skills[i.skillName].maxDamage&&(n.skills[i.skillName].maxDamage=i.damage),n.damageDealt+=i.damage,a.damageTaken+=i.damage,"Bleed"!==i.skillName&&(n.hits.total+=1,n.hits.crit+=u,n.hits.backAttack+=c,n.hits.frontAttack+=d,n.skills[i.skillName].hits.total+=1,n.skills[i.skillName].hits.crit+=u,n.skills[i.skillName].hits.backAttack+=c,n.skills[i.skillName].hits.frontAttack+=d),n.isPlayer&&(this.game.damageStatistics.totalDamageDealt+=i.damage,this.game.damageStatistics.topDamageDealt=Math.max(this.game.damageStatistics.topDamageDealt,n.damageDealt),n.skills[i.skillName].breakdown.push({timestamp:+i.timestamp,damage:i.damage,targetEntity:a.id,isCrit:o,isBackAttack:l,isFrontAttack:m})),a.isPlayer&&(this.game.damageStatistics.totalDamageTaken+=i.damage,this.game.damageStatistics.topDamageTaken=Math.max(this.game.damageStatistics.topDamageTaken,a.damageTaken)),0===this.game.fightStartedOn&&(this.game.fightStartedOn=+i.timestamp),this.game.lastCombatPacket=+i.timestamp}}},r.onHeal=function(e){var t=new C(e);this.debugLines&&this.emit("log",{type:"debug",message:"onHeal: "+t.id+", "+t.name+", "+t.healAmount});for(var i,n="",s=function(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return a(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?a(e,t):void 0}}(e))){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.healSources);!(i=s()).done;){var r=i.value;if(r.expires>=+t.timestamp){n=r.source;break}}n&&(this.updateEntity(n,{name:n}),this.game.entities[n].healingDone+=t.healAmount,this.game.entities[n].isPlayer&&(this.game.damageStatistics.totalHealingDone+=t.healAmount,this.game.damageStatistics.topHealingDone=Math.max(this.game.damageStatistics.topHealingDone,this.game.entities[n].healingDone)))},r.onBuff=function(e){var t=new R(e);this.debugLines&&this.emit("log",{type:"debug",message:"onBuff: "+t.id+", "+t.name+", "+t.buffId+", "+t.buffName+", "+t.sourceId+", "+t.sourceName+", "+t.shieldAmount}),t.shieldAmount&&t.isNew&&(this.updateEntity(t.name,{name:t.name}),this.game.entities[t.name].shieldDone+=t.shieldAmount,this.game.entities[t.name].isPlayer&&(this.game.damageStatistics.totalShieldDone+=t.shieldAmount,this.game.damageStatistics.topShieldDone=Math.max(this.game.damageStatistics.topShieldDone,this.game.entities[t.name].shieldDone)))},r.onCounterattack=function(e){var t=new P(e);this.debugLines&&this.emit("log",{type:"debug",message:"onCounterattack: "+t.id+", "+t.name}),this.updateEntity(t.name,{name:t.name}),this.game.entities[t.name].hits.counter+=1},s}(u.EventEmitter);
//# sourceMappingURL=parser.js.map
